use crate::utils;
use chrono::Local;
use std::fs::OpenOptions;
use std::io::Write; // Nutzt deinen Pfad-Resolver

/// Schreibt einen Log-Eintrag in die Datei `activity.log`.
///
/// Args:
/// - action: Kategorie oder Aktionstyp (z. B. INFO, ERROR)
/// - message: zu protokollierende Nachricht
///
/// Returns:
/// - () (keine Rückgabe; Fehler werden bewusst ignoriert, Best-Effort-Logging)
pub fn log(action: &str, message: &str) {
    // Zeitstempel generieren: [2025-05-20 14:00:05]
    let date: chrono::DateTime<Local> = Local::now();
    let timestamp: chrono::format::DelayedFormat<chrono::format::StrftimeItems<'_>> = date.format("%Y-%m-%d %H:%M:%S");

    // Format: [ZEIT] [ACTION] Message
    let log_entry = format!("[{}] [{}] {}\n", timestamp, action, message);

    // Pfad auflösen (liegt neben der .exe)
    let log_path: std::path::PathBuf = utils::resolve_path("activity.log");

    // Append-Mode öffnen (oder erstellen)
    if let Ok(mut file) = OpenOptions::new()
        .create(true)
        .write(true)
        .append(true)
        .open(log_path)
    {
        let _ = file.write_all(log_entry.as_bytes());
    }
}
